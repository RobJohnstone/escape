<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/assetLoader.js - escape</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="escape"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.4-25</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../classes/actors.html">actors</a></li>
            
                <li><a href="../classes/assetLoader.html">assetLoader</a></li>
            
                <li><a href="../classes/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../classes/campaign.html">campaign</a></li>
            
                <li><a href="../classes/entities.html">entities</a></li>
            
                <li><a href="../classes/entityPrototype.html">entityPrototype</a></li>
            
                <li><a href="../classes/game.html">game</a></li>
            
                <li><a href="../classes/graphics.html">graphics</a></li>
            
                <li><a href="../classes/input.html">input</a></li>
            
                <li><a href="../classes/map.html">map</a></li>
            
                <li><a href="../classes/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../classes/palette.html">palette</a></li>
            
                <li><a href="../classes/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../classes/polyfills.html">polyfills</a></li>
            
                <li><a href="../classes/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../classes/screen.html">screen</a></li>
            
                <li><a href="../classes/tabPrototype.html">tabPrototype</a></li>
            
                <li><a href="../classes/tiles.html">tiles</a></li>
            
                <li><a href="../classes/tilesTab.html">tilesTab</a></li>
            
                <li><a href="../classes/timer.html">timer</a></li>
            
                <li><a href="../classes/tools.html">tools</a></li>
            
                <li><a href="../classes/util.html">util</a></li>
            
                <li><a href="../classes/vector.html">vector</a></li>
            
                <li><a href="../classes/weapons.html">weapons</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../modules/actors.html">actors</a></li>
            
                <li><a href="../modules/assetLoader.html">assetLoader</a></li>
            
                <li><a href="../modules/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../modules/campaign.html">campaign</a></li>
            
                <li><a href="../modules/edit.html">edit</a></li>
            
                <li><a href="../modules/entities.html">entities</a></li>
            
                <li><a href="../modules/game.html">game</a></li>
            
                <li><a href="../modules/graphics.html">graphics</a></li>
            
                <li><a href="../modules/input.html">input</a></li>
            
                <li><a href="../modules/map.html">map</a></li>
            
                <li><a href="../modules/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../modules/palette.html">palette</a></li>
            
                <li><a href="../modules/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../modules/polyfills.html">polyfills</a></li>
            
                <li><a href="../modules/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../modules/screen.html">screen</a></li>
            
                <li><a href="../modules/tiles.html">tiles</a></li>
            
                <li><a href="../modules/timer.html">timer</a></li>
            
                <li><a href="../modules/util.html">util</a></li>
            
                <li><a href="../modules/vector.html">vector</a></li>
            
                <li><a href="../modules/weapons.html">weapons</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/assetLoader.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var E = E || {};

/**
 * Loads remote assets
 *
 * @module assetLoader
 * @class assetLoader
 */

E.assetLoader = (function() {
	&quot;use strict&quot;;

	var assetLoader = {
		loaded: false,
		totalAssets: 0,
		loadedAssets: 0,
		assetCache: {}
	};

	/**
	 * Loads an asset
	 *
	 * @param type {string} The type of asset to be loaded
	 * @param onLoad {function} The callback to be used once the asset has been loaded (the asset will be passed as the argument)
	 * @param args* {any} arguments specific to the type of asset being loaded
	 * @return this
	 */
	assetLoader.load = function(type, onLoad) {
		var args = Array.prototype.slice.call(arguments, 1);
		if (typeof assetLoader.load[type] === &#x27;function&#x27;) {
			assetLoader.load[type].apply(null, args);
		}
		else {
			throw new Exception(&quot;This asset type is not recognised: &quot; + type);
		}
		assetLoader.loaded = false;
		assetLoader.totalAssets++;
	};

	/**
	 * Loads maps
	 *
	 * @param onLoad {function} The callback to be invoked once the image has loaded
	 * @param mapName {string} The name of the map
	 */
	assetLoader.load.map = function(onLoad, mapName) {
		var url = &#x27;/maps/&#x27;+mapName;
		assetLoader.load.generic(onLoad, url, &#x27;json&#x27;);
	};

	/**
	 * Loads tilesets
	 *
	 * @param onLoad {function} The callback to be invoked once the tileset has loaded
	 * @param tilesetUrl {string} The tilesetName of the tileset
	 */
	assetLoader.load.tileset = function(onLoad, tilesetName) {
		var tilesetUrl = &#x27;assets/tilesets/&#x27;+tilesetName+&#x27;.json&#x27;,
			imageUrl = &#x27;assets/images/&#x27;+tilesetName+&#x27;.png&#x27;,
			tilesetObj = {};
		assetLoader.load.image(checkLoaded.bind(null, &#x27;image&#x27;), imageUrl);
		assetLoader.load.generic(checkLoaded.bind(null, &#x27;tileset&#x27;), tilesetUrl, &#x27;json&#x27;);

		function checkLoaded(type, result) {
			tilesetObj[type] = result;
			if (tilesetObj.image &amp;&amp; tilesetObj.tileset) {
				util.invokeCallback(onLoad, tilesetObj);
			}
		}
	};

	/**
	 * Loads images
	 *
	 * @param onLoad {function} The callback to be invoked once the image has loaded
	 */
	assetLoader.load.image = function(onLoad, url) {
		var image = assetLoader.getFromCache(url);
		if (image !== undefined) {
			assetLoader.load._success(url, image, onLoad);
		}
		else {
			image = new Image();
			image.src = url;
			image.onload = function() {
				assetLoader.load._success(url, this, onLoad);
			};
		}
	};

	/**
	 * Conducts the ajax request to load an asset
	 *
	 * @param onLoad {function} The callback for once this asset has loaded
	 * @param url {string} The url of the asset
	 * @param [dataType] {string} The type of the data returned from the server (follows jQuery ajax API)
	 * @return this
	 */
	assetLoader.load.generic = function(onLoad, url, dataType) {
		var asset = assetLoader.getFromCache(url);
		if (asset !== undefined) {
			assetLoader.load._success(url, asset, onLoad);
		}
		else {
			$.ajax({
				url: url,
				type: &#x27;get&#x27;,
				dataType: dataType,
				success: function(result) {
					assetLoader.load._success(url, result, onLoad);
				},
				error: function(jqXHR, textStatus, errorThrown) {
					assetLoader.load._error(jqXHR, textStatus, errorThrown);
				}
			});
		}
		return this;
	};

	/**
	 * The action to take when an asset has been successfully loaded
	 *
	 * @param result {string or as determined by dataType param passed into assetLoader.load.generic}
	 * @param onLoad {function} The callback following a successful load
	 */
	assetLoader.load._success = function(url, result, onLoad) {
		assetLoader.addToCache(url, result);
		util.invokeCallback(onLoad, result);
		assetLoader.loadedAssets++;
		if (assetLoader.loadedAssets === assetLoader.totalAssets) {
			util.invokeCallback(assetLoader.onLoad);
		}
	};

	/**
	 * The action to take when an asset has failed to load
	 *
	 * @param jqXHR 
	 * @param textStatus
	 * @param errorThrown
	 */
	assetLoader.load._error = function(jqXHR, textStatus, errorThrown) {
		throw new Error(&#x27;map loading error: &#x27;+textStatus);
	};

	/**
	 * Adds an asset to the asset cache
	 *
	 * @param url {String} the url of the asset (used as an id)
	 * @param data {any} the asset data
	 * @return this
	 */
	assetLoader.addToCache = function(url, data) {
		assetLoader.assetCache[url] = data;
		return this;
	};

	/**
	 * Retrieves an asset from the cache if it exists or returns null
	 *
	 * @param url {String} The url of the asset
	 * @return {any} The asset if it is in cache, undefined otherwise
	 */
	assetLoader.getFromCache = function(url) {
		return assetLoader.assetCache[url];
	};

	return assetLoader;
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
