<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/baddyPrototype.js - escape</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="escape"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.4-17</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../classes/actors.html">actors</a></li>
            
                <li><a href="../classes/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../classes/campaign.html">campaign</a></li>
            
                <li><a href="../classes/entities.html">entities</a></li>
            
                <li><a href="../classes/entityPrototype.html">entityPrototype</a></li>
            
                <li><a href="../classes/game.html">game</a></li>
            
                <li><a href="../classes/graphics.html">graphics</a></li>
            
                <li><a href="../classes/input.html">input</a></li>
            
                <li><a href="../classes/map.html">map</a></li>
            
                <li><a href="../classes/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../classes/palette.html">palette</a></li>
            
                <li><a href="../classes/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../classes/polyfills.html">polyfills</a></li>
            
                <li><a href="../classes/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../classes/screen.html">screen</a></li>
            
                <li><a href="../classes/tiles.html">tiles</a></li>
            
                <li><a href="../classes/timer.html">timer</a></li>
            
                <li><a href="../classes/util.html">util</a></li>
            
                <li><a href="../classes/vector.html">vector</a></li>
            
                <li><a href="../classes/weapons.html">weapons</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../modules/actors.html">actors</a></li>
            
                <li><a href="../modules/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../modules/campaign.html">campaign</a></li>
            
                <li><a href="../modules/entities.html">entities</a></li>
            
                <li><a href="../modules/game.html">game</a></li>
            
                <li><a href="../modules/graphics.html">graphics</a></li>
            
                <li><a href="../modules/input.html">input</a></li>
            
                <li><a href="../modules/map.html">map</a></li>
            
                <li><a href="../modules/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../modules/palette.html">palette</a></li>
            
                <li><a href="../modules/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../modules/polyfills.html">polyfills</a></li>
            
                <li><a href="../modules/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../modules/screen.html">screen</a></li>
            
                <li><a href="../modules/tiles.html">tiles</a></li>
            
                <li><a href="../modules/timer.html">timer</a></li>
            
                <li><a href="../modules/util.html">util</a></li>
            
                <li><a href="../modules/vector.html">vector</a></li>
            
                <li><a href="../modules/weapons.html">weapons</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/baddyPrototype.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Prototype for all baddies. Inherits from actor prototype
 *
 * For more information on how Escape uses inheritance see objectPrototype.js
 *
 * @module baddyPrototype
 * @class baddyPrototype
 * @extends actorPrototype
 */
E.baddyPrototype = (function() {
	&quot;use strict&quot;;

	var baddyPrototype = E.actorPrototype.extend();

	baddyPrototype.target = {x: 0, y: 0}; // note that currently all baddies share the same target as objects are passed by reference. This is fine as there&#x27;s only one player. If it becomes necessary to change this it is probably best done in Object.prototype.extend()

	/**
	 * Defines the action to be taken by baddies each frame
	 *
	 * @method process
	 * @return this
	 */
	baddyPrototype.process = function() {
		if (E.player.health &lt;= 0) this.mode = &#x27;watch&#x27;;
		else if (this.baddySeePlayer()) {
			this.setTarget(E.player);
			this.fire(E.player);
			if(this.targetDistance &gt; this.idealRange) {
				this.mode = &#x27;chase&#x27;;
			}
			else {
				this.mode = &#x27;attack&#x27;;
			}
		}
		this.processOrders();
		return this;
	};

	/**
	 * Takes the current orders and calls the appropriate function in the appropriate context
	 *
	 * @method processOrders
	 * @param orders string indicating the current orders
	 * @return this
	 */
	baddyPrototype.processOrders = function() {
		this.orders[this.mode].call(this);
		return this;
	};

	baddyPrototype.orders = {};

	/**
	 * The baddy&#x27;s default state. Currently does nothing
	 *
	 * @method orders.watch
	 * @return baddyPrototype
	 */
	baddyPrototype.orders.watch = function() {
		return baddyPrototype;
	};

	/**
	 * Baddy attacks its target. If the baddy can no longer see the target it gives chase
	 *
	 * @method orders.attack
	 * @return baddyPrototype
	 */
	baddyPrototype.orders.attack = function() {
		this.direction = E.vector.subtract(this, this.target);
		if (E.player.health &gt; 0 &amp;&amp; !this.baddySeePlayer()) {
			this.mode = &#x27;chase&#x27;;
		}
		return baddyPrototype;
	};

	/**
	 * Baddy chases after target based upon its last known location
	 * If the baddy gets to this location and still cannot see the player
	 * it goes into search mode
	 *
	 * @method orders.chase
	 * @return baddyPrototype
	 */
	baddyPrototype.orders.chase = function() {
		var distance = E.vector.distance(this, this.target);
		if (distance &lt; this.speed) {
			this.x = this.target.x;
			this.y = this.target.y;
			this.mode = &#x27;search&#x27;;
			this.direction = this.target.direction;
		}
		else {
			this.moveTo(this.target);
		}
		return baddyPrototype;
	};

	/**
	 * The baddy searches for the target by heading off in the direction the target
	 * was last seen moving
	 *
	 * @method orders.search
	 * @return baddyPrototype
	 */
	baddyPrototype.orders.search = function() {
		var velocity = E.vector.setLength(this.direction, this.speed);
		if (!this.move(velocity)) { // if path is blocked
			this.mode = &#x27;returnToStation&#x27;;
		}
		return baddyPrototype;
	};

	/**
	 * The baddy returns to its start location. It then enters watch mode
	 *
	 * @method orders.returnToStation
	 * @return baddyPrototype
	 */
	baddyPrototype.orders.returnToStation = function() {
		var distance = E.vector.distance(this, this.initial);
		if (distance &lt; this.speed) {
			this.x = this.initial.x;
			this.y = this.initial.y;
			this.mode = this.initial.mode;
			this.direction = this.initial.direction;
		}
		else {
			this.moveTo(this.initial);
		}
		return baddyPrototype;
	};

	/**
	 * The baddy goes to its current waypoint, then reverts to its original orders
	 *
	 * @method orders.goto
	 * @return baddyPrototype
	 */
	baddyPrototype.orders.goto = function() {
		var to = E.map.getTileCentre(this.patrolRoute[this.currentWaypoint]);
		var distance = E.vector.distance(this, to);
		if (distance &lt; this.speed) {
			this.x = to.x;
			this.y = to.y;
			this.mode = this.initial.mode;
		}
		else {
			this.moveTo(to);
		}
		return baddyPrototype;
	};

	/**
	 * The baddy patrols between a series of waypoints. When the baddy gets to the end, he returns directly to the first way point and starts again
	 *
	 * @method orders.patrol
	 * @return baddyPrototype
	 */
	baddyPrototype.orders.patrol = function() {
		if (!this.patrolRoute) {
			throw new Error(&#x27;This baddy does not have a patrol route specified&#x27;);
		}
		this.currentWaypoint = (this.currentWaypoint === undefined) ? 0 : this.currentWaypoint + 1;
		if (this.currentWaypoint &gt;= this.patrolRoute.length) {
			this.currentWaypoint = 0;
			this.mode = &#x27;returnToStation&#x27;;
		}
		else {
			this.mode = &#x27;goto&#x27;;
		}
		return baddyPrototype;
	};

	/**
	 * The baddy&#x27;s reaction to being hit
	 *
	 * @method hitHandler
	 * @param projectile the object the baddy has been hit by
	 * @return this
	 */
	baddyPrototype.hitHandler = function(projectile) {
		this.direction = E.vector.reverse(projectile.speed);
		return this;
	};

	/**
	 * Checks if the baddy can see the player
	 *
	 * @method baddySeePlayer
	 * @return boolean
	 */
	baddyPrototype.baddySeePlayer = function() {
		var targetVector = E.vector.subtract(this, E.player);
		if (E.vector.mag(targetVector) &gt; this.maxRange || E.vector.dot(this.direction, targetVector) &lt; 0) return false;
		return E.map.lineTraversable(this, E.player);
	};

	/**
	 * sets the baddy&#x27;s target and other target related information
	 *
	 * @method setTarget
	 * @return this
	 */
	baddyPrototype.setTarget = function(target) {
		this.targetTile = E.map.getTileIndex(target);
		this.target = $.extend({}, target, E.map.getTileCentre(this.targetTile));
		this.target.direction = E.vector.clone(target.direction);
		return this;
	};

	/**
	 * Renders the current patrol route
	 *
	 * @method renderPatrolRoute
	 * @return this
	 */
	baddyPrototype.renderPatrolRoute = function() {
		var route = this.patrolRoute;
		if (route) {
			for (var i=0, len=route.length-1; i&lt;len; i++) {
				E.graphics.vectors.line(E.map.getTileCentre(route[i]), E.map.getTileCentre(route[i+1]), &#x27;white&#x27;, true);
			}
		}
		return this;
	};

	return baddyPrototype;
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
