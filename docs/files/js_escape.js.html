<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/escape.js - escape</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="escape"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.4-19</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../classes/actors.html">actors</a></li>
            
                <li><a href="../classes/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../classes/campaign.html">campaign</a></li>
            
                <li><a href="../classes/entities.html">entities</a></li>
            
                <li><a href="../classes/entityPrototype.html">entityPrototype</a></li>
            
                <li><a href="../classes/game.html">game</a></li>
            
                <li><a href="../classes/graphics.html">graphics</a></li>
            
                <li><a href="../classes/input.html">input</a></li>
            
                <li><a href="../classes/map.html">map</a></li>
            
                <li><a href="../classes/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../classes/palette.html">palette</a></li>
            
                <li><a href="../classes/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../classes/polyfills.html">polyfills</a></li>
            
                <li><a href="../classes/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../classes/screen.html">screen</a></li>
            
                <li><a href="../classes/tiles.html">tiles</a></li>
            
                <li><a href="../classes/timer.html">timer</a></li>
            
                <li><a href="../classes/util.html">util</a></li>
            
                <li><a href="../classes/vector.html">vector</a></li>
            
                <li><a href="../classes/weapons.html">weapons</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../modules/actors.html">actors</a></li>
            
                <li><a href="../modules/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../modules/campaign.html">campaign</a></li>
            
                <li><a href="../modules/entities.html">entities</a></li>
            
                <li><a href="../modules/game.html">game</a></li>
            
                <li><a href="../modules/graphics.html">graphics</a></li>
            
                <li><a href="../modules/input.html">input</a></li>
            
                <li><a href="../modules/map.html">map</a></li>
            
                <li><a href="../modules/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../modules/palette.html">palette</a></li>
            
                <li><a href="../modules/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../modules/polyfills.html">polyfills</a></li>
            
                <li><a href="../modules/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../modules/screen.html">screen</a></li>
            
                <li><a href="../modules/tiles.html">tiles</a></li>
            
                <li><a href="../modules/timer.html">timer</a></li>
            
                <li><a href="../modules/util.html">util</a></li>
            
                <li><a href="../modules/vector.html">vector</a></li>
            
                <li><a href="../modules/weapons.html">weapons</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/escape.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * ESCAPE
 *
 * The game entry point code and loop 
 *
 * @module game
 */

var E = E || {}; // global namespace object

/**
 * @class game
 */
E.game = (function() {
	&quot;use strict&quot;;

	var game = {
		mode: &#x27;pause&#x27;
	};

	/**
	 * Initialise all required modules
	 *
	 * @method init
	 * @param mapName {string} the filename of the map minus the file extension
	 * @param start {boolean} Whether or not to start the game once the map has loaded (defaults to true)
	 * @return this
	 */
	game.init = function(mapName, start) {
		var callback = (start || start === undefined) ? game.start : null;
		E.graphics.init(&#x27;fullscreen&#x27;, &#x27;&#x27;);
		E.map.load(mapName, callback);
		return this;
	};

	/**
	 * Start the game
	 *
	 * @method start
	 * @return this
	 */
	game.start = function() {
		if (!E.graphics.clipping) {
			E.graphics.resizeCanvas(&#x27;game&#x27;, map.tileWidth * map.columns, map.tileHeight * map.rows);
		}
		game.resume();
	};

	/**
	 * Resume the game (either from scratch of from paused)
	 * Starts all required modules and starts the game loop
	 *
	 * @method resume
	 * @return this
	 */
	game.resume = function() {
		game.mode = &#x27;play&#x27;;
		E.input.start(&#x27;play&#x27;);
		E.timer.start(60);
		game.animationFrame = window.requestAnimationFrame(game.play);
	};

	/**
	 * The body of the game loop
	 *
	 * @method play
	 * @return this
	 */
	game.play = function() {
		if (game.mode === &#x27;play&#x27; || game.mode === &#x27;over&#x27;) {
			E.timer.process();
			E.entities.process();
			E.map.position(E.player);
			if (game.mode === &#x27;over&#x27;) {
				E.graphics.writeText(&#x27;Game over!&#x27;, 20, 30);
			}
			game.info();
			E.graphics.render();
			E.input.process();
			if (E.player.health &lt;= 0 &amp;&amp; game.mode === &#x27;play&#x27;) {
				game.over();
			}
			game.animationFrame = window.requestAnimationFrame(game.play);
		}
		else if (game.mode === &#x27;pause&#x27;) {
			//E.graphics.writeText(&#x27;Game paused. Press space to resume.&#x27;, 20, 30);
			E.graphics.renderText();
		}
		else if (game.mode === &#x27;mapComplete&#x27;) {
			game.mapComplete();
		}
		return this;
	};

	/**
	 * Displays debugging info and stats on the screen
	 *
	 * @method info
	 * @return this
	 */
	game.info = function() {
		E.graphics.writeText(&#x27;FPS: &#x27;+Math.round(E.timer.FPS), E.graphics.gameCanvas.width - 150, 30);
		E.graphics.writeText(&#x27;map.offset.x: &#x27;+E.map.offset.x, E.graphics.gameCanvas.width - 150, 50);
		E.graphics.writeText(&#x27;map.offset.y: &#x27;+E.map.offset.y, E.graphics.gameCanvas.width - 150, 70);
		E.graphics.writeText(&#x27;player.x: &#x27;+E.player.x, E.graphics.gameCanvas.width - 150, 90);
		E.graphics.writeText(&#x27;player.y: &#x27;+E.player.y, E.graphics.gameCanvas.width - 150, 110);
		E.graphics.writeText(&#x27;player.direction.x: &#x27;+E.player.direction.x, E.graphics.gameCanvas.width - 150, 130);
		E.graphics.writeText(&#x27;player.direction.y: &#x27;+E.player.direction.y, E.graphics.gameCanvas.width - 150, 150);
		E.graphics.writeText(&#x27;player.direction angle: &#x27;+E.vector.angle(E.player.direction), E.graphics.gameCanvas.width - 200, 170);
		E.graphics.writeText(&#x27;tile index: &#x27;+E.map.getTileIndex(E.player), E.graphics.gameCanvas.width - 150, 190);
		return this;
	};

	/**
	 * Pauses the game
	 *
	 * @method pause
	 * @return this
	 */
	game.pause = function(msg) {
		msg = msg || &#x27;Game paused. Press space to resume.&#x27;;
		game.mode = &#x27;pause&#x27;;
		E.input.start(&#x27;pause&#x27;);
		E.graphics.writeText(msg, 20, 30);
		E.graphics.renderText();
		return this;
	};

	/**
	 * Action to take when the game is over
	 *
	 * @method over
	 * @return this
	 */
	game.over = function() {
		game.mode = &#x27;over&#x27;;
		E.input.start(&#x27;over&#x27;);
		return this;
	};

	/**
	 * Action to take when map complete
	 *
	 * @method mapComplete
	 * @return this
	 */
	game.mapComplete = function() {
		if (E.campaign.current &lt; E.campaign.data.maps.length -1) {
			E.campaign.current++;
			game.reset(false);
			E.screen.change(&#x27;mapScreen&#x27;);
		}
		else {
			game.end(&#x27;&#x27;);
			E.screen.change(&#x27;campaignSuccess&#x27;);
		}
	};

	/**
	 * Resets game state in order to allow a new game to start
	 *
	 * @method reset
	 * @param start {boolean} Whether or not to start the game once the map has loaded (defaults to true)
	 * @return this
	 */
	game.reset = function(start) {
		E.entities.instances = [];
		cancelAnimationFrame(game.animationFrame);
		game.init(E.campaign.getCurrentmap(), start);
		return this;
	};

	/**
	 * End the game
	 *
	 * @method end 
	 * @return this
	 */
	game.end = function(msg) {
		msg = msg || &#x27;The game has ended&#x27;;
		game.pause(msg);
		E.input.stop();
		return this;
	};

	/*
	 * Code entry point
	 */
	$(function() {
		E.screen.init(&#x27;campaignScreen&#x27;);
		E.campaign.load(&#x27;Escape&#x27;, function() {
			game.init(E.campaign.getCurrentmap(), false);
		});

		// event handlers
		$(&#x27;body&#x27;).on(&#x27;click&#x27;, &#x27;#campaignStart&#x27;, function() {
			E.screen.change(&#x27;mapScreen&#x27;);
		});
		$(&#x27;body&#x27;).on(&#x27;click&#x27;, &#x27;#playMap&#x27;, function() {
			E.screen.change(&#x27;gameContainer&#x27;);
			game.start();
		});
	});
	util.onVisibilityChange(function() {
		E.game.pause();
	});

	return game;
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
