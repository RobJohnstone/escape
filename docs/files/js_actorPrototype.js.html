<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/actorPrototype.js - escape</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="escape"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.4-23</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../classes/actors.html">actors</a></li>
            
                <li><a href="../classes/assetLoader.html">assetLoader</a></li>
            
                <li><a href="../classes/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../classes/campaign.html">campaign</a></li>
            
                <li><a href="../classes/entities.html">entities</a></li>
            
                <li><a href="../classes/entityPrototype.html">entityPrototype</a></li>
            
                <li><a href="../classes/game.html">game</a></li>
            
                <li><a href="../classes/graphics.html">graphics</a></li>
            
                <li><a href="../classes/input.html">input</a></li>
            
                <li><a href="../classes/map.html">map</a></li>
            
                <li><a href="../classes/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../classes/palette.html">palette</a></li>
            
                <li><a href="../classes/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../classes/polyfills.html">polyfills</a></li>
            
                <li><a href="../classes/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../classes/screen.html">screen</a></li>
            
                <li><a href="../classes/tabPrototype.html">tabPrototype</a></li>
            
                <li><a href="../classes/tiles.html">tiles</a></li>
            
                <li><a href="../classes/tilesTab.html">tilesTab</a></li>
            
                <li><a href="../classes/timer.html">timer</a></li>
            
                <li><a href="../classes/tools.html">tools</a></li>
            
                <li><a href="../classes/util.html">util</a></li>
            
                <li><a href="../classes/vector.html">vector</a></li>
            
                <li><a href="../classes/weapons.html">weapons</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../modules/actors.html">actors</a></li>
            
                <li><a href="../modules/assetLoader.html">assetLoader</a></li>
            
                <li><a href="../modules/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../modules/campaign.html">campaign</a></li>
            
                <li><a href="../modules/edit.html">edit</a></li>
            
                <li><a href="../modules/entities.html">entities</a></li>
            
                <li><a href="../modules/game.html">game</a></li>
            
                <li><a href="../modules/graphics.html">graphics</a></li>
            
                <li><a href="../modules/input.html">input</a></li>
            
                <li><a href="../modules/map.html">map</a></li>
            
                <li><a href="../modules/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../modules/palette.html">palette</a></li>
            
                <li><a href="../modules/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../modules/polyfills.html">polyfills</a></li>
            
                <li><a href="../modules/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../modules/screen.html">screen</a></li>
            
                <li><a href="../modules/tiles.html">tiles</a></li>
            
                <li><a href="../modules/timer.html">timer</a></li>
            
                <li><a href="../modules/util.html">util</a></li>
            
                <li><a href="../modules/vector.html">vector</a></li>
            
                <li><a href="../modules/weapons.html">weapons</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/actorPrototype.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var E = E || {};

/**
 * Prototype for all actors. Inherits from entity prototype
 *
 * For more information on how Escape uses inheritance see objectPrototype.js
 *
 * @module actorPrototype
 * @class actorPrototype
 * @extends entityPrototype
 */

E.actorPrototype = (function () {
	&quot;use strict&quot;;

	var actorPrototype = E.entityPrototype.extend();

	actorPrototype.entityType = &#x27;actor&#x27;;
	actorPrototype.hittable = true;
	actorPrototype.health = 100;
	actorPrototype.weapon = &#x27;gun&#x27;;

	/**
	 * Moves the actor in the direction indicated by vector v. If this would result in a collision with the map
	 * then a more sensible vector is chosen and the actor moves that way instead
	 *
	 * @method move
	 * @param v {vector} the movement vector
	 * @return {boolean} true if the actor was unable to move. This is useful for the AI
	 */
	actorPrototype.move = function(v) {
		var newPos,
			vector = E.vector,
			blocked = false;
		// set length of v to correct value given actor&#x27;s speed and the current frame rate
		v = vector.setLength(v, this.speed * E.timer.coeff);
		v = E.map.collisionAdjust(this, v);
		// move
		newPos = E.vector.round(vector.add(this, v));
		this.direction = vector.mag(v) ? vector.normalise(v) : this.direction;
		// check if actor was completely blocked
		if (this.x === newPos.x &amp;&amp; this.y === newPos.y) {
			blocked = true;
		}
		// save position
		this.x = newPos.x;
		this.y = newPos.y;

		return !blocked; // useful for AI
	};

	/**
	 * Moves actor towards the position indicated, taking into account the actor&#x27;s speed
	 * Movement is attempted &quot;as the crow flies&quot; with no route selection
	 * 
	 * @method moveTowards
	 * @param position {vector} the location to move towards
	 * @return this
	 */
	actorPrototype.moveTowards = function(position) {
		var targetVector = E.vector.subtract(this, position);
		targetVector = E.vector.setLength(targetVector, this.speed);
		this.move(targetVector);
		return this;
	};

	/**
	 * Moves actor towards the position indicated, while performing sensible route selection
	 * Route selection algorithm is A*
	 *
	 * @method moveTo
	 * @param position {vector} the location to move to
	 * @return this
	 */
	actorPrototype.moveTo = function(position) {
		var map = E.map,
			start = map.getTileCoords(map.getTileIndex(this)),
			end = map.getTileCoords(map.getTileIndex(position)),
			path = aStar(map.pathGrid, start, end, &#x27;Euclidean&#x27;);
		if (path.length &gt; 1) {
			this.moveTowards(map.getTileCentre(path[1]));
		}
		else if (path.length === 1) {
			this.moveTowards(map.getTileCentre(path[0]));
		}
		return this;
	};

	/**
	 * handles being hit by a projectile, including effect on health and action to take upon death
	 *
	 * @method hit
	 * @param projectile {object} The object that is doing the hitting. Should inherit from projectilePrototype
	 * @return this;
	 */
	actorPrototype.hit = function(projectile) {
		if (!this.invulnerable) {
			this.health -= projectile.damage;
			if (this.health &lt;= 0) {
				this.remove = true;
			}
		}
		if (typeof this.hitHandler === &#x27;function&#x27;) {
			this.hitHandler(projectile); // the AI reaction to being hit
		}
		return this;
	};

	/**
	 * Fires the actor&#x27;s weapon
	 *
	 * @method fire
	 * @param target {vector} The location that is to be aimed at
	 * @return this
	 */
	actorPrototype.fire = function(target) {
		var weapon = E.weapons[this.weapon],
			projectileSpeed = weapon.projectileSpeed,
			targetVector = E.vector.subtract(this, target),
			speed = E.vector.setLength(targetVector, projectileSpeed),
			firer = this,
			projectile;
		if (this.lastFired === undefined || this.lastFired &lt; E.timer.time - weapon.reloadTime) {
			projectile = E.projectilePrototype.create({
				&#x27;x&#x27;: this.x,
				&#x27;y&#x27;: this.y,
				&#x27;width&#x27;: 4,
				&#x27;height&#x27;: 4,
				&#x27;colour&#x27;: &#x27;yellow&#x27;,
				speed: speed,
				&#x27;firerId&#x27;: firer.entityId,
				&#x27;damage&#x27;: weapon.damage
			});
			this.lastFired = E.timer.time;
		}
		this.direction = E.vector.normalise(targetVector);
		return this;
	};

	/*
	 * Renders the actor. This is placeholder code until the bitmap graphics code has been written
	 *
	 * @method render
	 * @return this
	 */
	actorPrototype.render = function() {
		/* Placeholder code */
		E.graphics.gameContext.save();
		E.graphics.gameContext.translate(E.map.offset.x, E.map.offset.y);
		E.graphics.gameContext.translate(this.x, this.y);
		E.graphics.gameContext.rotate(-E.vector.angle(this.direction, {x:0, y:-1}, true));
		E.graphics.gameContext.beginPath();
		E.graphics.gameContext.moveTo(-this.halfWidth, this.halfHeight);
		E.graphics.gameContext.lineTo(0, -this.halfHeight);
		E.graphics.gameContext.lineTo(this.halfWidth, this.halfHeight);
		E.graphics.gameContext.fillStyle = this.colour;
		E.graphics.gameContext.fill();
		E.graphics.gameContext.restore();
		E.graphics.writeText(this.health, this.x - this.halfWidth + E.map.offset.x, this.y + E.map.offset.y);
		return this;
	};

	/**
	 * Outputs an abbreviated version of the entity, suitable for saving to file
	 * 
	 * @method abbr
	 * @return {object}
	 */
	actorPrototype.abbr = function() {
		var obj = {
			type: this.type,
			direction: this.direction,
			x: this.x,
			y: this.y,
			mode: this.mode,
			patrolRoute: this.patrolRoute
		};
		return obj;
	};

	return actorPrototype;
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
