<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/campaign.js - escape</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="escape"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.4-23</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../classes/actors.html">actors</a></li>
            
                <li><a href="../classes/assetLoader.html">assetLoader</a></li>
            
                <li><a href="../classes/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../classes/campaign.html">campaign</a></li>
            
                <li><a href="../classes/entities.html">entities</a></li>
            
                <li><a href="../classes/entityPrototype.html">entityPrototype</a></li>
            
                <li><a href="../classes/game.html">game</a></li>
            
                <li><a href="../classes/graphics.html">graphics</a></li>
            
                <li><a href="../classes/input.html">input</a></li>
            
                <li><a href="../classes/map.html">map</a></li>
            
                <li><a href="../classes/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../classes/palette.html">palette</a></li>
            
                <li><a href="../classes/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../classes/polyfills.html">polyfills</a></li>
            
                <li><a href="../classes/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../classes/screen.html">screen</a></li>
            
                <li><a href="../classes/tabPrototype.html">tabPrototype</a></li>
            
                <li><a href="../classes/tiles.html">tiles</a></li>
            
                <li><a href="../classes/tilesTab.html">tilesTab</a></li>
            
                <li><a href="../classes/timer.html">timer</a></li>
            
                <li><a href="../classes/tools.html">tools</a></li>
            
                <li><a href="../classes/util.html">util</a></li>
            
                <li><a href="../classes/vector.html">vector</a></li>
            
                <li><a href="../classes/weapons.html">weapons</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../modules/actors.html">actors</a></li>
            
                <li><a href="../modules/assetLoader.html">assetLoader</a></li>
            
                <li><a href="../modules/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../modules/campaign.html">campaign</a></li>
            
                <li><a href="../modules/edit.html">edit</a></li>
            
                <li><a href="../modules/entities.html">entities</a></li>
            
                <li><a href="../modules/game.html">game</a></li>
            
                <li><a href="../modules/graphics.html">graphics</a></li>
            
                <li><a href="../modules/input.html">input</a></li>
            
                <li><a href="../modules/map.html">map</a></li>
            
                <li><a href="../modules/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../modules/palette.html">palette</a></li>
            
                <li><a href="../modules/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../modules/polyfills.html">polyfills</a></li>
            
                <li><a href="../modules/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../modules/screen.html">screen</a></li>
            
                <li><a href="../modules/tiles.html">tiles</a></li>
            
                <li><a href="../modules/timer.html">timer</a></li>
            
                <li><a href="../modules/util.html">util</a></li>
            
                <li><a href="../modules/vector.html">vector</a></li>
            
                <li><a href="../modules/weapons.html">weapons</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/campaign.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var E = E || {};

/**
 * Handles all state and behaviour for campaigns
 *
 * @module campaign
 * @class campaign
 */

E.campaign = (function() {
	&quot;use strict&quot;;

	var campaign = {
		campaigns: [],
		addedMap: false
	};

	var _campaignTemplate = {
		name: &#x27;&#x27;,
		description: &#x27;&#x27;,
		maps: [],
		successTitle: &#x27;&#x27;,
		successMessage: &#x27;&#x27;
	};

	/**
	 * Loads a campaign
	 *
	 * @method load
	 * @param campaignName {string} The name of the campaign. If campaignName is an object it treats that
	 * as the campaignObj rather than loading via ajax
	 * @param callback {function} A function to execute once the campaign has been loaded successfully
	 * @return this
	 */
	campaign.load = function(campaignName, callback) {
		if (typeof campaignName === &#x27;object&#x27;) {
			_successHandler(campaignName);
		}
		else {
			$.ajax({
				url: &#x27;/campaigns/&#x27;+campaignName,
				type: &#x27;get&#x27;,
				dataType: &#x27;json&#x27;,
				success: function(campaignObj) {
					_successHandler(campaignObj);
				},
				error: function(jqXHR, textStatus, errorThrown) {
					throw new Error(&#x27;campaign loading error: &#x27;+textStatus);
				}
			});
		}
		return this;

		function _successHandler(campaignObj) {
			campaign.data = campaignObj;
			campaign.current = 0;
			campaign.render();
			if (typeof callback === &#x27;function&#x27;) {
				callback();
			}
		}
	};

	/**
	 * Gets the name of the current map
	 *
	 * @method getCurrentmap
	 * @return {string} The name of the current map
	 */
	campaign.getCurrentmap = function() {
		return campaign.data.maps[campaign.current];
	};

	/**
	 * Populates the relevant DOM elements with campaign information
	 *
	 * @method render
	 * @return this;
	 */
	campaign.render = function() {
		var campaignTemplate = $(&#x27;#campaignScreenTemplate&#x27;).text().trim(),
			campaignCompiled = _.template(campaignTemplate),
			successTemplate = $(&#x27;#campaignSuccessTemplate&#x27;).text().trim(),
			successCompiled = _.template(successTemplate);
		$(&#x27;#campaignScreen&#x27;).html(campaignCompiled(campaign.data));
		$(&#x27;#campaignSuccess&#x27;).html(successCompiled(campaign.data));
		return this;
	};

	/**
	 * Creates a new campaign. The only field populated is the name.
	 * This method does not save the newly created campaign (use campaign.save())
	 *
	 * @method create
	 * @param name {string} The name of the new campaign
	 * @return this
	 */
	campaign.newCampaign = function(name) {
		var newCampaign = _campaignTemplate.clone();
		if (name !== &#x27;&#x27;) {
			newCampaign.name = name;
		}
		campaign.load(newCampaign);
		E.screen.update();
		return this;
	};

	/**
	 * Saves the current information about the campaign
	 * Note: this requires that the server is in &#x27;dev&#x27; mode
	 *
	 * @method save
	 * @param callback {function} The function to execute once the campaign has been saved
	 * @return this
	 */
	campaign.save = function(callback) {
		$.ajax({
			url: &#x27;/campaigns/&#x27;+campaign.data.name,
			type: &#x27;post&#x27;,
			data: &#x27;data=&#x27;+JSON.stringify(campaign.data),
			success: function(result) {
				campaign.list();
				if (typeof callback === &#x27;function&#x27;) {
					callback(result);
				}
			}
		});
		return this;
	};

	/**
	 * updates the value of a field in the campaign
	 * can remove the prefix campaign from property names while preserving camel-casing
	 *
	 * @method update
	 * @param field {string} The field to update (either the property name or a the id of a form element associated with that property)
	 * @param value {any} The new value
	 * @return this
	 */
	campaign.update = function(field, value) {
		if (field.substr(0, 8) === &#x27;campaign&#x27;) {
			field = field.substr(8);
			field = field.charAt(0).toLowerCase() + field.slice(1);
		}
		campaign.data[field] = value;
		return this;
	};

	/**
	 * Adds a map to the campaign
	 * Note this does not check whether the map actually exists
	 *
	 * @method addMap
	 * @param mapName {string} The name of the map
	 * @param index {number} The index which this map should occupy within the 
	 * array (defaults to adding the map to the end)
	 * @return this
	 */
	campaign.addMap = function(mapName, index) {
		mapName = mapName || campaign.addedMap;
		if (index === undefined) {
			campaign.data.maps.push(mapName);
		}
		else {
			campaign.data.maps.splice(index, 0, mapName);
		}
		E.campaign.addedMap = false;
		return this;
	};

	/**
	 * Moves the map up one in the order (nearer the start)
	 *
	 * @param mapName {string} The name of the map
	 * @return this;
	 */
	campaign.moveMapUp = function(mapName) {
		var mapsArr = campaign.data.maps,
			currentIndex = mapsArr.indexOf(mapName);
		if (currentIndex &gt; 0) {
			campaign.data.maps = util.moveArrayElement(mapsArr, currentIndex, currentIndex-1);
			campaign.render();
		}
		return this;
	};

	/**
	 * Moves the map down one in the order (nearer the end)
	 *
	 * @param mapName {string} The name of the map
	 * @return this;
	 */
	campaign.moveMapDown = function(mapName) {
		var mapsArr = campaign.data.maps,
			currentIndex = mapsArr.indexOf(mapName);
		if (currentIndex &lt; mapsArr.length-1) {
			campaign.data.maps = util.moveArrayElement(mapsArr, currentIndex, currentIndex+1);
			campaign.render();
		}
		return this;
	};

	/**
	 * Populates the relevant DOM ul with the campaigns
	 *
	 * @method list
	 * @return this
	 */
	campaign.list = function() {
		var template = $(&#x27;#campaignListItemTemplate&#x27;).text().trim(),
			compiled = _.template(template),
			html = [];
		$.ajax({
			url: &#x27;/campaigns&#x27;,
			type: &#x27;GET&#x27;,
			dataType: &#x27;json&#x27;,
			success: function(campaigns) {
				campaign.campaigns = campaigns;
				campaigns.forEach(function(campaignName) {
					html.push(compiled({name: campaignName}));
				});
				$(&#x27;#campaignList&#x27;).html(html.join(&#x27;&#x27;));
			}
		});
		return this;
	};

	return campaign;
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
