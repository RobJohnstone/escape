<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/graphics.js - escape</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="escape"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.4-19</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../classes/actors.html">actors</a></li>
            
                <li><a href="../classes/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../classes/campaign.html">campaign</a></li>
            
                <li><a href="../classes/entities.html">entities</a></li>
            
                <li><a href="../classes/entityPrototype.html">entityPrototype</a></li>
            
                <li><a href="../classes/game.html">game</a></li>
            
                <li><a href="../classes/graphics.html">graphics</a></li>
            
                <li><a href="../classes/input.html">input</a></li>
            
                <li><a href="../classes/map.html">map</a></li>
            
                <li><a href="../classes/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../classes/palette.html">palette</a></li>
            
                <li><a href="../classes/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../classes/polyfills.html">polyfills</a></li>
            
                <li><a href="../classes/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../classes/screen.html">screen</a></li>
            
                <li><a href="../classes/tiles.html">tiles</a></li>
            
                <li><a href="../classes/timer.html">timer</a></li>
            
                <li><a href="../classes/util.html">util</a></li>
            
                <li><a href="../classes/vector.html">vector</a></li>
            
                <li><a href="../classes/weapons.html">weapons</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/actorPrototype.html">actorPrototype</a></li>
            
                <li><a href="../modules/actors.html">actors</a></li>
            
                <li><a href="../modules/baddyPrototype.html">baddyPrototype</a></li>
            
                <li><a href="../modules/campaign.html">campaign</a></li>
            
                <li><a href="../modules/entities.html">entities</a></li>
            
                <li><a href="../modules/game.html">game</a></li>
            
                <li><a href="../modules/graphics.html">graphics</a></li>
            
                <li><a href="../modules/input.html">input</a></li>
            
                <li><a href="../modules/map.html">map</a></li>
            
                <li><a href="../modules/objectPrototype.html">objectPrototype</a></li>
            
                <li><a href="../modules/palette.html">palette</a></li>
            
                <li><a href="../modules/playerPrototype.html">playerPrototype</a></li>
            
                <li><a href="../modules/polyfills.html">polyfills</a></li>
            
                <li><a href="../modules/projectilePrototype.html">projectilePrototype</a></li>
            
                <li><a href="../modules/screen.html">screen</a></li>
            
                <li><a href="../modules/tiles.html">tiles</a></li>
            
                <li><a href="../modules/timer.html">timer</a></li>
            
                <li><a href="../modules/util.html">util</a></li>
            
                <li><a href="../modules/vector.html">vector</a></li>
            
                <li><a href="../modules/weapons.html">weapons</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/graphics.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var E = E || {};

/**
 * Graphics module
 * Contains all code that outputs to the canvas
 *
 * @module graphics
 * @class graphics
 */
E.graphics = (function() {
	&quot;use strict&quot;;

	var graphics = {};

	/**
	 *	Initialise graphics settings and call specific graphics initialisation methods
	 *
	 * @method init
	 * @param width {number} the width of the canvas in pixels. If set to &quot;fullscreen&quot; the 
	 * width and height are set to the viewport width and height
	 * @param height {number} the height of the canvas in pixels
	 * @param clipping {boolean} if true, only the visible portion of the map is rendered
	 * @return this
	 */
	graphics.init = function(width, height, clipping) {
		$(&#x27;#gameContainer&#x27;).html(&#x27;&#x27;);
		graphics.viewport = {
			width: $(&#x27;#gameContainer&#x27;).width(),
			height: $(&#x27;#gameContainer&#x27;).height()
		};
		if (width === &#x27;fullscreen&#x27;) {
			graphics.fullscreen = true;
			width = graphics.viewport.width;
			height = graphics.viewport.height;
		}
		graphics.initCanvas(&#x27;game&#x27;, width, height);
		graphics.clipping = (clipping === undefined) ? true : clipping;
		return this;
	};

	/**
	 * Create and initialise the canvas
	 *
	 * @method initCanvas
	 * @param name {string} the name of the canvas (in case support for multiple canvases is needed later)
	 * @param width {number} the width of the canvas in pixels
	 * @param height {number} the height of the canvas in pixels
	 * @return this
	 */
	graphics.initCanvas = function(name, width, height) {
		if (!width) width = 800;
		if (!height) height = 600;
		$(&#x27;#gameContainer&#x27;).html(&#x27;&lt;canvas id=&quot;&#x27;+name+&#x27;Canvas&quot; class=&quot;defaultBorder&quot; width=&quot;&#x27;+ width +&#x27;px&quot; height=&quot;&#x27; + height +&#x27;px&quot;&gt;Your broswer does not support the &quot;canvas element&quot;. To play this game you will need a more modern browser.&lt;/canvas&gt;&#x27;);
		$(&#x27;#&#x27;+name+&#x27;Canvas&#x27;).css({width: +width+&#x27;px&#x27;, height: height+&#x27;px&#x27;});
		graphics[name+&#x27;Canvas&#x27;] = document.getElementById(name+&#x27;Canvas&#x27;);
		graphics[name+&#x27;Context&#x27;] = graphics.gameCanvas.getContext(&#x27;2d&#x27;);
		graphics[name+&#x27;Canvas&#x27;].width = width;
		graphics[name+&#x27;Canvas&#x27;].height = height;
		return this;
	};

	graphics.textQueue = []; // text that should be rendered this frame

	/**
	 *	Adds text to graphics.textQueue to be rendered later this frame
	 *
	 * @method writeText
	 * @param string {string} the text to be written
	 * @param x {number} the x coord of the string&#x27;s position on the canvas
	 * @param y {number} the y coord of the string&#x27;s position on the canvas
	 * @return this
	 */
	graphics.writeText = function(string, x, y) {
		graphics.textQueue.push({string: string, x: x, y: y});
		return this;
	};

	/**
	 * renders the passed string immediately without taking measures to ensure that other
	 * rendered items this frame do not obscure the text
	 *
	 * @method writeTextNow
	 * @param string {string} the text to be rendered
	 * @param x {number} the x coord of the string&#x27;s position on the canvas
	 * @param y {number} the y coord of the string&#x27;s position on the canvas
	 * @return this
	 */
	graphics.writeTextNow = function(string, x, y) {
		var fillStyle = graphics.gameContext.fillStyle,
			strokeStyle = graphics.gameContext.strokeStyle,
			font = graphics.gameContext.font;
		graphics.gameContext.fillStyle = &#x27;white&#x27;;
		graphics.gameContext.strokeStyle = &#x27;black&#x27;;
		graphics.gameContext.font = &#x27;12pt Arial&#x27;;
		graphics.gameContext.strokeText(string, x, y);
		graphics.gameContext.fillText(string, x, y);
		graphics.gameContext.fillStyle = fillStyle;
		graphics.gameContext.strokeStyle = strokeStyle;
		graphics.gameContext.font = font;
		return this;
	};

	/**
	 * Renders all text in the queue
	 *
	 * @method renderText
	 * @return this
	 */
	graphics.renderText = function() {
		graphics.textQueue.forEach(function(item) {
			graphics.writeTextNow(item.string, item.x, item.y);
		});
		graphics.textQueue = [];
		return this;
	};

	/**
	 * object storing all vectors that need to be rendered this frame
	 */
	graphics.vectors = {
		commands: [],
		/**
		 * Renders each vector
		 *
		 * @method vectors.render
		 * @return this
		 */
		render: function() {
			for (var i=0; i&lt;this.commands.length; i++) {
				this.commands[i]();
			}
			this.commands = [];
			return this;
		},

		/**
		 * Adds a vector command to be rendered this frame
		 *
		 * @method vectors.command
		 * @param command {function} contains code for rendering a specific vector using native HTML5 canvas methods
		 * @return this
		 */
		command: function(command) {
			this.commands.push(command);
			return this;
		},

		/**
		 * Draws a line this frame
		 *
		 * @method line
		 * @param start {vector} The start point
		 * @param end {vector} The end point
		 * @param colour {string} The colour of the line (defaults to white)
		 * @param mapCoords {boolean} Whether to use map coords rather than canvas coords (defaults to canvas)
		 * @return this
		 */
		line: function(start, end, colour, mapCoords) {
			E.graphics.vectors.command(function() {
				E.graphics.vectors.lineNow(start, end, colour, mapCoords);
			});
			return this;
		},

		/**
		 * Draws a line now
		 *
		 * @method lineNow
		 * @param start {vector} The start point
		 * @param end {vector} The end point
		 * @param colour {string} The colour of the line (defaults to white)
		 * @param mapCoords {boolean} Whether to use map coords rather than canvas coords (defaults to canvas)
		 * @return this
		 */
		lineNow: function(start, end, colour, mapCoords) {
			var currentStrokeStyle = E.graphics.gameContext.strokeStyle;
			if (mapCoords) {
				start = E.vector.add(E.map.offset, start);
				end = E.vector.add(E.map.offset, end);
			}
			start = E.vector.round(start);
			end = E.vector.round(end);
			colour = colour || &#x27;white&#x27;;
			E.graphics.gameContext.strokeStyle = colour;
			E.graphics.gameContext.beginPath();
			E.graphics.gameContext.moveTo(start.x-0.5, start.y-0.5); // subtract .5 to minimise antialiasing for lines of 1 pixel thickness
			E.graphics.gameContext.lineTo(end.x-0.5, end.y-0.5);
			E.graphics.gameContext.stroke();
			E.graphics.gameContext.strokeStyle = currentStrokeStyle;
			return this;
		},

		/**
		 * Draws a rectangle (outline only) this frame
		 *
		 * @method.rect
		 * @param topLeft {vector} The coordinates of the top left corner of the rect
		 * @param dimensions {vector} The width and height of the rect (defailts to 50 for both);
		 * @param colour {string} The colour of the rect (defaults to white)
		 * @param mapCoords {boolean} Whether to use map coords rather than canvas coords (defaults to canvas)
		 * @return this
		 */
		rect: function(topLeft, dimensions, colour, mapCoords) {
			E.graphics.vectors.command(function() {
				E.graphics.vectors.rectNow(topLeft, dimensions, colour, mapCoords);
			});
			return this;
		},

		/**
		 * Draws a rectangle (outline only) now
		 *
		 * @method rectNow
		 * @param topLeft {vector} The coordinates of the top left corner of the rect
		 * @param dimensions {vector} The width and height of the rect (defailts to 50 for both);
		 * @param colour {string} The colour of the rect (defaults to white)
		 * @param mapCoords {boolean} Whether to use map coords rather than canvas coords (defaults to canvas)
		 * @return this
		 */
		rectNow: function(topLeft, dimensions, colour, mapCoords) {
			var currentStrokeStyle = E.graphics.gameContext.strokeStyle;
			if (mapCoords) {
				topLeft = E.vector.add(E.map.offset, topLeft);
			}
			topLeft = E.vector.round(topLeft);
			colour = colour || &#x27;white&#x27;;
			dimensions = E.vector.round(dimensions) || {
				x: 50,
				y: 50
			};
			E.graphics.gameContext.strokeStyle = colour;
			E.graphics.gameContext.strokeRect(topLeft.x+0.5, topLeft.y+0.5, dimensions.x, dimensions.y);
			E.graphics.gameContext.strokeStyle = currentStrokeStyle;
			return this;
		},

		/**
		 * Draws a circle (filled) this frame
		 *
		 * @method circle
		 * @param centre {vector} The centre of the circle
		 * @param radius {number} The radius of the circle (defaults to 50)
		 * @param colour {string} The colour of the circle (defaults to white)
		 * @param mapCoords {boolean} Whether to use map coords rather than canvas coords (defaults to canvas)
		 * @return this
		 */
		circle: function(centre, radius, colour, mapCoords) {
			E.graphics.vectors.command(function() {
				E.graphics.vectors.circleNow(centre, radius, colour, mapCoords);
			});
			return this;
		},

		/**
		 * Draws a circle (filled) now
		 *
		 * @method circleNow
		 * @param centre {vector} The centre of the circle
		 * @param radius {number} The radius of the circle (defaults to 50)
		 * @param colour {string} The colour of the circle (defaults to white)
		 * @param mapCoords {boolean} Whether to use map coords rather than canvas coords (defaults to canvas)
		 * @return this
		 */
		circleNow: function(centre, radius, colour, mapCoords) {
			if (mapCoords) {
				centre = E.vector.add(E.map.offset, centre);
			}
			centre = E.vector.round(centre);
			radius = Math.round(radius) || 50;
			colour = colour || &#x27;white&#x27;;
			E.graphics.gameContext.beginPath();
			E.graphics.gameContext.arc(centre.x, centre.y, radius, 0, 2 * Math.PI);
			E.graphics.gameContext.fillStyle = colour;
			E.graphics.gameContext.fill();
			return this;
		}
	};

	/**
	 * Renders the canvas and all graphics
	 *
	 * @method render
	 * @return this
	 */
	graphics.render = function() {
		if (graphics.clipping) {
			graphics.gameContext.clearRect(-E.map.offset.x, -E.map.offset.y, graphics.gameCanvas.width, graphics.gameCanvas.height);
		}
		else {
			graphics.gameContext.clearRect(-E.map.offset.x, -E.map.offset.y, graphics.viewport.width, graphics.viewport.height);
		}
		E.map.render();
		E.entities.render();
		if (E.palette) E.palette.render();
		E.input.render();
		graphics.vectors.render();
		graphics.renderText();
		return this;
	};

	/**
	 * Changes the size of a canvas
	 *
	 * @method resizeCanvas
	 * @param name {string} the name of the canvas to be resized
	 * @param width {number} the width of the canvas in pixels
	 * @param height {number} the height of the canvas in pixels
	 * @return this
	 */
	graphics.resizeCanvas = function(name, width, height) {
		graphics[name+&#x27;Canvas&#x27;].width = width;
		graphics[name+&#x27;Canvas&#x27;].height = height;
		$(&#x27;#&#x27;+name+&#x27;Canvas&#x27;).css({width: +width+&#x27;px&#x27;, height: height+&#x27;px&#x27;});
		return this;
	};

	return graphics;
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
